apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: GitRepository
metadata:
    name: synology-csi
    namespace: flux-system
spec:
    gitImplementation: go-git
    ignore: |
        # exclude all
        /*
        # include gitops dirs
        !/deploy/kubernetes/v1.20
    interval: 30m
    ref:
        branch: main
    timeout: 60s
    url: https://github.com/SynologyOpenSource/synology-csi.git
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1lehw0hk4xkp8nnp3qjdxzp899705w7j0wsmfa7jvlt2fn0h86pyq79fusk
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCM05TSDJOYWtueUZFdkly
            WlRYZG92VU8yZUowSms5RWt6WHJxckZHUVZnCkFCMzFLRTFtYVpKVG13c3huQ2ts
            alVhUTZ0YXBsVGdOZUtsWGMxQ1NxdncKLS0tIDdvREVLeU1CbUlIMmJGNktRSlMx
            aGNIZENQck5KcWNUaUhVNzArTWovU3cKO/tluNtTuHoOJ77ATukuPsZBlCYpeRPW
            VLOTANX6s/wDjggjg5a2bm9VdEFgbm0TRG+zjrXwyA/qwL0GsIivlQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-04-20T21:30:59Z"
    mac: ENC[AES256_GCM,data:wXWObTOt+rOwpQY2rcu9qFl4/QJWVKx5u5xpn7LQW2RL4ZnvX5aPr0qxYOaoLntN10MOeaESr6ZzcCAIpnTsRQrTL5QGeP9/FxelsG1Zx/eiJDasTCRrRnbedNJp2GUrrNqkTDDEdU4rs8KjbfBTPsrXV9Gxcntp+6/npaZQ/Rk=,iv:SRy57HsI1H1K2y4rPS8rhtEit4WH58OFR/agKM8tkG0=,tag:vjy71iZaxi/1a15tflZKvg==,type:str]
    pgp: []
    encrypted_regex: ^(patch)$
    version: 3.7.3
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
    name: synology-csi
    namespace: flux-system
spec:
    interval: 30m
    path: ./deploy/kubernetes/v1.20
    prune: true
    wait: false
    decryption:
        provider: sops
        secretRef:
            name: sops-age
    sourceRef:
        kind: GitRepository
        name: synology-csi
    dependsOn:
        - name: flux
    postBuild:
        substituteFrom:
            - kind: ConfigMap
              name: cluster-settings
              optional: false
    patches:
        - patch: ENC[AES256_GCM,data:w9XNWx1kAvpDCJ3ifzxCm4Eyrc+aWl8U1BcWSVjLVhstHxsjoKwbXht6lziZmdg6Ve2bI1CPijuUqHh7rGYrUA0Yt3YKIKOuFgOnkFvxrSeQfTZ6fB5ky//AGR2a4rZGI/T/siNmx9WKkODMWHaREhiRDHRG6XSpHv/Dbtf3WZAcEfc/sx4KAEsRsE2M+I0OYK0XWB47eBntFHkii1ASHX43i996h5GNKX4rutqEiBYl92H8cBTwCnQxGE2UgK4B2nrtRBtLviwv0enMB5YKii/4ust5o+CkYkXU8L8vkkXnohLKICxfFf7JQMLWe9oMRkjp7RNMIsuzzuzA/VqsT4JZvzrvNjy9cc0LMsXx2txWAMPVwkvbI0FNBeW1/lyg8HJYEdp7Z04M/A9qN3VdYD6n46e+Yk1QUQIQvBGmc/zTf+rreR0vnf4Dpw3ZbkZwNt0ieya3Iurlk+AAktyhpVH7MnL1ImQWQ2v+zYoFv6o=,iv:T4Q3d6vBFnPOlbZAox+JaBgiB5zxgCdB12beS64ilIo=,tag:dQM6piCLVn0gOiOE02pRXQ==,type:str]
          target:
            kind: StorageClass
            name: synology-iscsi-storage
        - patch: ENC[AES256_GCM,data:EXizjgQBomOcqNt63afA4T3FrwmNJ8V9+7vWfji6lvLQOli5mH3roCCJzH2UZy0gA+ge92i54tstDFbgcyjzaeJ8k4unioVKWYFCBHRHy//wDnJ1TkpJTmF4skA0iQZ+b7BHsIYmqG4Xvk6jGLtJ0uTC+KSapmluDba1ec3BnKAyNnKv5ZdZe1q6Dqs77ne4zzo3S3xiBfEw40maHPrN2U1Um1hF2Rx8DPeEoOnk8JsSr0XOVEGVf1Ew8XOuh0U50YKrS51F0sC7c4X6XGTAaKHkV+nwRxkAcP5dNigMHjZeFgKKrkTCx9KAojdyGQXJY6mKr3cboV5J5TDHC0Frme7bSinTJzjm++aHBrTGuaGEDr7S+TzQz1D0y3n9jSzbEMk42y40tzH0me6Ym3Pao4D949hHDdR3nfIxqmOBKUgsyeRrSHOYDl4bBHjumSD68qgrA1ey3D4Gsy+T2e3EGm5e0pS4HzA09N/Slbt1FhaqUj+Fiy/Pw50pYEybnV75wkGZNoEADzXDsAJ0KMT2JDPkVK0cYmQ69W0rgLQAS538Rl6kPOCcAST7jhcA5OgXzkGY8AYFfTYQW6MDVJVEvie2nIbyCnIj9YjjLy9jV+QLRVxORCsOlMa0rmvmaP4XgHk+Hr0SVoAo6HweVXkJu2mTnJZsRc3QVq5VrK1B5psiLqTzDdbN2LH/hTs8VgWwuAhUKLXbotanIAvTVkVvkKXDoLbCDTknLd1bbMtD3z01wXvXGZbHvVEzUTZTQBeYlffk70KRvyuO4zE0FooR7y/YG+NkqLA6b4U7oSiPuEX1nr9ksYFN9klmgzrntp58zF8ESGajwaaH0hSdHNTvtVcrBGOrUIdnXISsiIvtTibr7P4lOxkBKXl7x69hEx22x6fQy3F0DJTy9obkTbE9nYO2wn1f9m840lJsmMk3VXXVAdI5atBJXrz6LjsfymGgg7bbN+GqFH4j/MyC+tR9+g==,iv:A0YmBqdk7b24VhHg+iG4akNEeW2fgiTcKV9MOv04qso=,tag:KKGP0xmUalkND97ANOUKtw==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1lehw0hk4xkp8nnp3qjdxzp899705w7j0wsmfa7jvlt2fn0h86pyq79fusk
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCM05TSDJOYWtueUZFdkly
            WlRYZG92VU8yZUowSms5RWt6WHJxckZHUVZnCkFCMzFLRTFtYVpKVG13c3huQ2ts
            alVhUTZ0YXBsVGdOZUtsWGMxQ1NxdncKLS0tIDdvREVLeU1CbUlIMmJGNktRSlMx
            aGNIZENQck5KcWNUaUhVNzArTWovU3cKO/tluNtTuHoOJ77ATukuPsZBlCYpeRPW
            VLOTANX6s/wDjggjg5a2bm9VdEFgbm0TRG+zjrXwyA/qwL0GsIivlQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-04-20T21:30:59Z"
    mac: ENC[AES256_GCM,data:wXWObTOt+rOwpQY2rcu9qFl4/QJWVKx5u5xpn7LQW2RL4ZnvX5aPr0qxYOaoLntN10MOeaESr6ZzcCAIpnTsRQrTL5QGeP9/FxelsG1Zx/eiJDasTCRrRnbedNJp2GUrrNqkTDDEdU4rs8KjbfBTPsrXV9Gxcntp+6/npaZQ/Rk=,iv:SRy57HsI1H1K2y4rPS8rhtEit4WH58OFR/agKM8tkG0=,tag:vjy71iZaxi/1a15tflZKvg==,type:str]
    pgp: []
    encrypted_regex: ^(patch)$
    version: 3.7.3
