apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: GitRepository
metadata:
    name: synology-csi
    namespace: flux-system
spec:
    gitImplementation: go-git
    ignore: |
        # exclude all
        /*
        # include gitops dirs
        !/deploy/kubernetes/v1.20
        snapshotter
    interval: 30m
    ref:
        branch: main
    timeout: 60s
    url: https://github.com/zebernst/synology-csi-talos.git
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1lehw0hk4xkp8nnp3qjdxzp899705w7j0wsmfa7jvlt2fn0h86pyq79fusk
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCM05TSDJOYWtueUZFdkly
            WlRYZG92VU8yZUowSms5RWt6WHJxckZHUVZnCkFCMzFLRTFtYVpKVG13c3huQ2ts
            alVhUTZ0YXBsVGdOZUtsWGMxQ1NxdncKLS0tIDdvREVLeU1CbUlIMmJGNktRSlMx
            aGNIZENQck5KcWNUaUhVNzArTWovU3cKO/tluNtTuHoOJ77ATukuPsZBlCYpeRPW
            VLOTANX6s/wDjggjg5a2bm9VdEFgbm0TRG+zjrXwyA/qwL0GsIivlQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-04-23T21:51:14Z"
    mac: ENC[AES256_GCM,data:apw2xC+mabBaR/HFYF9bgBDzbCGO4WetG5xcTpVbp4V7tJYQhaM/eNyex/IP2muTcKeHnNnNafl52RLjNaRGK5r4LUmjafNESCO1F0qPiJsf9ZwyeoWx83xR5cmR4/ye64t4gPd0p3Wnw1fjebpwS7QRC2E+R3Dfcs71uqVzHVQ=,iv:axWDwk1iLCzV+dXJNaZxnXTBpvbBhidHLequKOC0gZ4=,tag:RtW+Gm4I4oqKhvFSrsbNCw==,type:str]
    pgp: []
    encrypted_regex: ^(patch)$
    version: 3.7.3
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
    name: synology-csi
    namespace: flux-system
spec:
    interval: 30m
    path: ./deploy/kubernetes/v1.20
    prune: true
    wait: false
    decryption:
        provider: sops
        secretRef:
            name: sops-age
    sourceRef:
        kind: GitRepository
        name: synology-csi
    dependsOn:
        - name: flux
    postBuild:
        substituteFrom:
            - kind: ConfigMap
              name: cluster-settings
              optional: false
    patches:
        - patch: ENC[AES256_GCM,data:qq91EBVnWvmAnB3QxOtpRMgcz/AOyKF11CkLddATK+lOUXNHODgSVOwFguSdPeQb9ct07EJDqCTHleN2iEH7r3kwMd8v+do2K+UiPqhrCnKiXCMTbFCi3aod8oQ1tp+b3q0axMJS8b9FQZnlg2fkwIGcGbU/xTtSmgx+Y7Z+SG1WixYm4OPzo6VqElsNERQPzvKuJRyQHPsDdy9qWsAH7IUzCt4y21tE3jQwCf0uGYWfSCfIQSFnhGOPhN4zsdSiJO5TnVud6Iqi0uNQoY58+ADGlBOkcobsvrRhubAz+Eg45bQ4mhQpqgvAAOpIgyi0AtfJ064YYxbveHPkhf3nYN/QsjRsUbCZH3HNxgbSVcRB2ufT3K1EPylOixOY1Ib2+FZ71YnGqkLlWGf8B8lluPCDzHOeGxsUdD3ULKwcSqSmThzEtmxUpKydADMFAvuAqb2dpaICQ5CF/pkr8Fp6FGEBnnRLhIn/CbO4ZG/jpBzxV62M13+frV7pEyyFC5FjmXtpLugkTaXjsRaIv7RsauWmDKIjKA3Qw/cKMkJWyVn5uaLNBqL84yHFHkcg4SShwRmR49cQJSkIa7Y=,iv:1BCw5y3OOj10fhbLD3khkx6vpWJmDBZJ3/bIdlvuC6Q=,tag:QMabJiizg1s/dH+I+ebyxg==,type:str]
          target:
            name: synology-iscsi
            kind: StorageClass
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1lehw0hk4xkp8nnp3qjdxzp899705w7j0wsmfa7jvlt2fn0h86pyq79fusk
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCM05TSDJOYWtueUZFdkly
            WlRYZG92VU8yZUowSms5RWt6WHJxckZHUVZnCkFCMzFLRTFtYVpKVG13c3huQ2ts
            alVhUTZ0YXBsVGdOZUtsWGMxQ1NxdncKLS0tIDdvREVLeU1CbUlIMmJGNktRSlMx
            aGNIZENQck5KcWNUaUhVNzArTWovU3cKO/tluNtTuHoOJ77ATukuPsZBlCYpeRPW
            VLOTANX6s/wDjggjg5a2bm9VdEFgbm0TRG+zjrXwyA/qwL0GsIivlQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-04-23T21:51:14Z"
    mac: ENC[AES256_GCM,data:apw2xC+mabBaR/HFYF9bgBDzbCGO4WetG5xcTpVbp4V7tJYQhaM/eNyex/IP2muTcKeHnNnNafl52RLjNaRGK5r4LUmjafNESCO1F0qPiJsf9ZwyeoWx83xR5cmR4/ye64t4gPd0p3Wnw1fjebpwS7QRC2E+R3Dfcs71uqVzHVQ=,iv:axWDwk1iLCzV+dXJNaZxnXTBpvbBhidHLequKOC0gZ4=,tag:RtW+Gm4I4oqKhvFSrsbNCw==,type:str]
    pgp: []
    encrypted_regex: ^(patch)$
    version: 3.7.3
